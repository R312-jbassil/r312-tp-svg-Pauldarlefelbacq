---
import Layout from "../../layouts/Layout.astro";
import { ui } from "../../i18n/ui";
import pb from "../../utils/pb";
import { Collections } from "../../utils/pocketbase-types";

const locale = Astro.locals.lang as 'en' | 'fr' ?? 'en';
console.log('Locale in index:', locale);

const user = Astro.locals.user; // Récupère l'utilisateur connecté
const svgList = await pb
    .collection(Collections.Svg)
    .getFullList({
        sort: "-created", // Trie les SVGs du plus récent au plus ancien
        filter: user ? `user = "${user.id}"` : "", // Filtre pour n'afficher que les SVGs de l'utilisateur
    });
---

<Layout>
	<div class="container mx-auto p-6 max-w-7xl">
		<div class="flex justify-between items-center mb-8">
			<h1 class="text-2xl font-bold">{ui[locale].gallery.title}</h1>
			<a href="/generator" class="btn btn-primary">{ui[locale].gallery.generatebutton}</a>
		</div>
		
		<div id="svg-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{svgList.length === 0 ? (
				<div class="col-span-full text-center py-12">
					<p class="text-lg text-base-content/60">{ui[locale].gallery.noSVG || "Aucun SVG sauvegardé"}</p>
					<a href="/generator" class="btn btn-primary mt-4">{ui[locale].gallery.createSVG || "Créer un SVG"}</a>
				</div>
			) : (
				svgList.map((svg: any) => (
					<a href={`/gallery/${svg.id}`} class="card bg-base-100 shadow-md hover:shadow-lg transition-shadow cursor-pointer">
						<div class="card-body">
							<h2 class="card-title text-lg">{svg.nom}</h2>
							<div class="border border-base-300 rounded-lg h-48 flex items-center justify-center bg-base-50 overflow-hidden">
								<Fragment set:html={svg.code} />
							</div>
							<div class="text-xs text-base-content/60 mt-2">
								{ui[locale].gallery.createdOn || "Créé le"} {new Date(svg.created).toLocaleDateString(locale === 'fr' ? 'fr-FR' : 'en-US')}
							</div>
							<div class="card-actions justify-end mt-2">
								<span class="badge badge-outline">{ui[locale].gallery.viewDetails}</span>
							</div>
						</div>
					</a>
				))
			)}
		</div>
	</div>
</Layout>
